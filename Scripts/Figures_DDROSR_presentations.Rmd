---
title: "Figures DDR-OSR, for presentations"
author: "Elsje Burgers"
last modified: "2024-05-02"
output: html_document
---

This script can be used to simulate all different model versions described in the publication. It can also be used to replicate the images in the publication.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Some settings

Loading the required packages, functions etc. It is also possible to indicate here if you want to save the images that are being generated.

```{r}
rm(list = ls())
library(tidyverse)
library(deSolve)
library(svglite)

source("functions.R")
source("models.R")

SaveFigures = 0 #if 1 figures will be saved, if 0 figures will not be saved

tspan <-  seq(0, 62, by = 1)

```

# Experimental data

First we load the experimental data that was generated before with the data analysis script.

```{r}
# GFP data
measurements_DEM = read.csv(file = "..//Data//GFPdata_DEM_2023-02-15.csv", header=TRUE)
measurements_ETO = read.csv(file = "..//Data//GFPdata_ETO_2023-02-15.csv", header=TRUE)

# Viability data
viability_DEM = read.csv(file = "..//Data//ViabilityData_DEM_2023-11-06.csv", header=TRUE)
viability_ETO = read.csv(file = "..//Data//ViabilityData_ETO_2023-11-06.csv", header=TRUE)

doses_DEM = unique(measurements_DEM$dose_uM)
doses_ETO = unique(measurements_ETO$dose_uM)
```

## Compute mean

Here we compute the mean of the experimental data.

```{r}
mean_DEM = measurements_DEM %>%
  group_by(StateVar, treatment, dose_uM, timepoints)%>%
  summarise(mean_interpol = mean(data4modelInterpol, na.rm=TRUE), 
            sd_interpol = sd(data4modelInterpol,na.rm=TRUE)) %>%
  ungroup()

mean_ETO = measurements_ETO %>%
  group_by(StateVar, treatment, dose_uM, timepoints)%>%
  summarise(mean_interpol = mean(data4modelInterpol, na.rm=TRUE), 
            sd_interpol = sd(data4modelInterpol,na.rm=TRUE)) %>%
  ungroup()

```
### Figure S1: Viability ETO

These figures show the viability data of ETO.

```{r}
FigureS1a = ggplot(data = viability_ETO) + theme_bw() +
  geom_ribbon(aes(x = mean_time, ymin = mean_count_norm-sd_count_norm, 
                  ymax = mean_count_norm+sd_count_norm, 
                  fill = as.factor(dose_uM)), alpha = 0.2) +
  geom_line(aes(x = mean_time, y = mean_count_norm, color = as.factor(dose_uM)), 
            linewidth=1) + 
  xlab("Time (hours)") + ylab("Normalised cell count") +
  labs(color = expression(paste("Dose (", mu, "M)")), 
       fill = expression(paste("Dose (", mu, "M)")))

FigureS1b = ggplot(data = viability_ETO) + theme_bw() +
  geom_ribbon(aes(x = mean_time, ymin = mean_AnV-sd_AnV, ymax = mean_AnV+sd_AnV, 
                  fill = as.factor(dose_uM)), alpha = 0.2) +
  geom_line(aes(x = mean_time, y = mean_AnV, color = as.factor(dose_uM)), 
            linewidth=1) + 
  xlab("Time (hours)") + ylab("Fraction AnV positive cells") +
  labs(color = expression(paste("Dose (", mu, "M)")), 
       fill = expression(paste("Dose (", mu, "M)")))

FigureS1c = ggplot(data = viability_ETO) + theme_bw() +
  geom_ribbon(aes(x = mean_time, ymin = mean_PI-sd_PI, ymax = mean_PI+sd_PI, 
                  fill = as.factor(dose_uM)), alpha = 0.2) +
  geom_line(aes(x = mean_time, y = mean_PI, color = as.factor(dose_uM)), 
            linewidth=1) + 
  xlab("Time (hours)") + ylab("Fraction PI positive cells") +
  labs(color = expression(paste("Dose (", mu, "M)")), 
       fill = expression(paste("Dose (", mu, "M)")))

print(FigureS1a)
print(FigureS1b)
print(FigureS1c)

if(SaveFigures == 1){
  ggsave("FigureS1a.svg", plot = FigureS1a, path = "..//Figures", width = 13,
         height = 10, units = "cm", dpi = 300)
  ggsave("FigureS1b.svg", plot = FigureS1b, path = "..//Figures", width = 13,
           height = 10, units = "cm", dpi = 300)
  ggsave("FigureS1c.svg", plot = FigureS1c, path = "..//Figures", width = 13,
         height = 10, units = "cm", dpi = 300)
}

```
# Base model DDR

The simulation of the base DDR model for exposure to etoposide.

```{r}
file = list.files("..//FittingResults", pattern='DDRbase')
simu_pars_DDRbase = read.csv(file = paste("..//FittingResults//", file, sep=""), 
                             header = TRUE) %>%
    add_row(X = "n", est_value = 4)


inistate_DDR = c(
  DD = simu_pars_DDRbase$est_value[simu_pars_DDRbase$X=="DD_ss"],
  P53 = simu_pars_DDRbase$est_value[simu_pars_DDRbase$X=="P53_ss"],
  P53P = simu_pars_DDRbase$est_value[simu_pars_DDRbase$X=="P53P_ss"],
  MDM2 = 0.9496844,
  p21 = 0.659682552,
  BTG2 = 0.455598913
)

ECs_ETO = c(simu_pars_DDRbase$est_value[simu_pars_DDRbase$X=="EC1"],
        simu_pars_DDRbase$est_value[simu_pars_DDRbase$X=="EC2"],
        simu_pars_DDRbase$est_value[simu_pars_DDRbase$X=="EC3"], 
        simu_pars_DDRbase$est_value[simu_pars_DDRbase$X=="EC4"], 
        simu_pars_DDRbase$est_value[simu_pars_DDRbase$X=="EC5"], 
        simu_pars_DDRbase$est_value[simu_pars_DDRbase$X=="EC6"])

modeldata_DDRbase = run_model(baseDDR, tspan, doses_ETO, ECs_ETO, inistate_DDR, 
                              simu_pars_DDRbase$X, simu_pars_DDRbase$est_value)
modeldata_DDRbase = include_p53(modeldata_DDRbase)

```
## Figure 1b: base model DDR - 2.5 & 25 uM ETO

Plotting of the base DDR model for exposure to 2.5 & 25 uM etoposide.

```{r}
SVs = c("BTG2", "MDM2", "p21", "p53")
doses = c(2.5, 25)

Figure1b = ggplot() + theme_bw() +
  geom_point(data = filter(measurements_ETO, StateVar %in% SVs & 
                             dose_uM %in% doses), 
             aes(x = timeAfterExposure, y = data4modelReal, 
                 shape = as.factor(replID)), color = "dark grey") + 
  geom_line(data = filter(mean_ETO, StateVar %in% SVs & dose_uM %in% doses), 
            aes(x = timepoints, y = mean_interpol, col = "Mean"), linewidth = 1.5) +
  geom_line(data = filter(modeldata_DDRbase, StateVar %in% SVs & 
                            dose_uM %in% doses), 
            aes(x = time, y = value, col = "Simulation"), linewidth = 1.5) +
  facet_grid(cols = vars(dose_uM), rows = vars(StateVar), scales = "free") +
  scale_color_manual(name = "", breaks = c("Mean", "Simulation"),
                       values = c("Mean" = "black", "Simulation" = "firebrick")) + 
  xlab("Time (hours)") + ylab("GFP intensity") + theme(legend.position = "bottom") +
  labs(shape = "Replicate")

print(Figure1b)

if(SaveFigures == 1){
  ggsave("Figure1b.svg", plot = Figure1b, path = "..//Figures", width = 12,
         height = 22, units = "cm", dpi = 300)
}

```

### Figure S2: all doses DDR simulation

Plotting of the base DDR model for exposure to all concentrations of etoposide.

```{r}
SVs = c("BTG2", "MDM2", "p21", "p53")

FigureS2 = ggplot() + theme_bw() +
  geom_point(data = filter(measurements_ETO, StateVar %in% SVs), 
             aes(x = timeAfterExposure, y = data4modelReal, 
                 shape = as.factor(replID)), color = "dark grey") + 
  geom_line(data = filter(mean_ETO, StateVar %in% SVs), 
            aes(x = timepoints, y = mean_interpol, colour = "Mean"), 
            linewidth = 1.5) +
  geom_line(data = filter(modeldata_DDRbase, StateVar %in% SVs), 
            aes(x = time, y = value, colour = "Simulation"), linewidth = 1.5) +
  facet_grid(cols = vars(dose_uM), rows = vars(StateVar), scales = "free") +
  scale_color_manual(name = "", breaks = c("Mean", "Simulation"),
                       values = c("Mean" = "black", "Simulation" = "firebrick")) +    
  xlab("Time (hours)") + ylab("GFP intensity") +
  labs(shape = "Replicate")

print(FigureS2)

if(SaveFigures == 1){
  ggsave("FigureS2.pdf", plot = FigureS2, path = "..//Figures", width = 30,
         height = 20, units = "cm", dpi = 300)
}
```

## Figure 1c: effect ETO on NRF2 & SRXN1

This figure shows for each concentration of etoposide the effect on NRF2 and SRXN1 over time.

```{r}
Figure1c = ggplot(data = filter(mean_DEM, StateVar == "NRF2" | StateVar == "SRXN1")) +
  theme_bw() +
  geom_ribbon(aes(x = timepoints, ymin = mean_interpol-sd_interpol, 
                  ymax = mean_interpol+sd_interpol, fill = as.factor(dose_uM)), 
              alpha = 0.2) +
  geom_line(aes(x = timepoints, y = mean_interpol, color = as.factor(dose_uM)), 
            linewidth=1) + expand_limits(x = 0, y = 0) +
  facet_wrap(vars(StateVar), scales = "free", ncol = 2) + xlab("Time (hours)") + ylab("GFP intensity") + 
  labs(color = expression(paste("Dose (", mu, "M)")), 
       fill = expression(paste("Dose (", mu, "M)")))
  
  print(Figure1c)
  
  if(SaveFigures == 1){
  ggsave("Lecture3.svg", plot = Figure1c, path = "..//Figures//Lecture", 
         width = 20, height = 9, units = "cm", dpi = 300)
}
```

### Figure S3: Viability DEM

These figures show the viability data of DEM.

```{r}
FigureS3a = ggplot(data = viability_DEM) + theme_bw() +
  geom_ribbon(aes(x = mean_time, ymin = mean_count_norm-sd_count_norm, 
                  ymax = mean_count_norm+sd_count_norm, 
                  fill = as.factor(dose_uM)), alpha = 0.2) +
  geom_line(aes(x = mean_time, y = mean_count_norm, color = as.factor(dose_uM)), 
            linewidth=1) + 
  xlab("Time (hours)") + ylab("Normalised cell count") +
  labs(color = expression(paste("Dose (", mu, "M)")), 
       fill = expression(paste("Dose (", mu, "M)")))

FigureS3b = ggplot(data = viability_DEM) + theme_bw() +
  geom_ribbon(aes(x = mean_time, ymin = mean_AnV-sd_AnV, ymax = mean_AnV+sd_AnV, 
                  fill = as.factor(dose_uM)), alpha = 0.2) +
  geom_line(aes(x = mean_time, y = mean_AnV, color = as.factor(dose_uM)), 
            linewidth=1) + 
  xlab("Time (hours)") + ylab("Fraction AnV positive cells") +
  labs(color = expression(paste("Dose (", mu, "M)")), 
       fill = expression(paste("Dose (", mu, "M)")))

FigureS3c = ggplot(data = viability_DEM) + theme_bw() +
  geom_ribbon(aes(x = mean_time, ymin = mean_PI-sd_PI, ymax = mean_PI+sd_PI, 
                  fill = as.factor(dose_uM)), alpha = 0.2) +
  geom_line(aes(x = mean_time, y = mean_PI, color = as.factor(dose_uM)), 
            linewidth=1) + 
  xlab("Time (hours)") + ylab("Fraction PI positive cells") +
  labs(color = expression(paste("Dose (", mu, "M)")), 
       fill = expression(paste("Dose (", mu, "M)")))

print(FigureS3a)
print(FigureS3b)
print(FigureS3c)

if(SaveFigures == 1){
  ggsave("FigureS3a.svg", plot = FigureS3a, path = "..//Figures", width = 13,
         height = 10, units = "cm", dpi = 300)
  ggsave("FigureS3b.svg", plot = FigureS3b, path = "..//Figures", width = 13,
         height = 10, units = "cm", dpi = 300)
  ggsave("FigureS3c.svg", plot = FigureS3c, path = "..//Figures", width = 13,
         height = 10, units = "cm", dpi = 300)
}
```
# Base model OSR

The simulation of the base OSR model for exposure to DEM.

```{r}
file = list.files("..//FittingResults", pattern='OSRbase')
simu_pars_OSRbase = read.csv(file  = paste("..//FittingResults//", file, sep = ""), 
                             header = TRUE)

inistate_OSR = c(
  KEAP1 = simu_pars_OSRbase$est_value[simu_pars_OSRbase$X=="KEAP1_ss"],
  modifiedK1 = 0,
  NRF2 =  0.77378141,
  SRXN1 = 0.433384695
)

ECs_DEM = c(simu_pars_OSRbase$est_value[simu_pars_OSRbase$X=="EC1"],
        simu_pars_OSRbase$est_value[simu_pars_OSRbase$X=="EC2"],
        simu_pars_OSRbase$est_value[simu_pars_OSRbase$X=="EC3"], 
        simu_pars_OSRbase$est_value[simu_pars_OSRbase$X=="EC4"], 
        simu_pars_OSRbase$est_value[simu_pars_OSRbase$X=="EC5"], 
        simu_pars_OSRbase$est_value[simu_pars_OSRbase$X=="EC6"],
        simu_pars_OSRbase$est_value[simu_pars_OSRbase$X=="EC7"], 
        simu_pars_OSRbase$est_value[simu_pars_OSRbase$X=="EC8"])

modeldata_OSRbase = run_model(baseOSR, tspan, doses_DEM, ECs_DEM, inistate_OSR, 
                              simu_pars_OSRbase$X, simu_pars_OSRbase$est_value)
modeldata_OSRbase = include_p53(modeldata_OSRbase)

##### unadapted model
file = list.files("..//FittingResults//", pattern='OSRwithout')
simu_pars_OSRunadapted = read.csv(file  = paste("..//FittingResults//", file, sep = ""), 
                             header = TRUE) %>%
  add_row(X = "Vmax_K1", est_value = 0) %>%
  add_row(X = "Km_K1", est_value = 1) %>%
  add_row(X = "hillK1", est_value = 1)

inistate_OSRunadapted = c(
  KEAP1 = simu_pars_OSRunadapted$est_value[simu_pars_OSRunadapted$X=="KEAP1_ss"],
  modifiedK1 = 0,
  NRF2 =  0.77378141,
  SRXN1 = 0.433384695
)

ECs_OSRunadapted = c(simu_pars_OSRunadapted$est_value[simu_pars_OSRunadapted$X=="EC1"],
        simu_pars_OSRunadapted$est_value[simu_pars_OSRunadapted$X=="EC2"],
        simu_pars_OSRunadapted$est_value[simu_pars_OSRunadapted$X=="EC3"], 
        simu_pars_OSRunadapted$est_value[simu_pars_OSRunadapted$X=="EC4"], 
        simu_pars_OSRunadapted$est_value[simu_pars_OSRunadapted$X=="EC5"], 
        simu_pars_OSRunadapted$est_value[simu_pars_OSRunadapted$X=="EC6"],
        simu_pars_OSRunadapted$est_value[simu_pars_OSRunadapted$X=="EC7"], 
        simu_pars_OSRunadapted$est_value[simu_pars_OSRunadapted$X=="EC8"])
  

modeldata_OSRunadapted = run_model(baseOSR, tspan, doses_DEM, ECs_OSRunadapted,
                                   inistate_OSRunadapted, simu_pars_OSRunadapted$X,
                                   simu_pars_OSRunadapted$est_value)
modeldata_OSRunadapted = include_p53(modeldata_OSRunadapted)


```
## Figure 2b: base model OSR - 20 & 200 uM DEM

Plotting of the base OSR model for exposure to 20 & 200 uM DEM.

```{r}
SVs = c("NRF2", "SRXN1")
doses = c(20,200) #unique(measurements_DEM$dose_uM)

Figure2b = ggplot() + theme_bw() +
  geom_point(data = filter(measurements_DEM, StateVar %in% SVs & dose_uM %in% doses), 
             aes(x = timeAfterExposure, y = data4modelReal, shape = as.factor(replID)), 
             color = "dark grey") + 
  geom_line(data = filter(mean_DEM, StateVar %in% SVs & dose_uM %in% doses), 
            aes(x = timepoints, y = mean_interpol, col = "Mean"), linewidth = 1.5) +
  geom_line(data = filter(modeldata_OSRunadapted, StateVar %in% SVs & dose_uM %in% doses),
            aes(x = time, y = value, col = "Unadapted model"), linewidth = 1.5) +
  geom_line(data = filter(modeldata_OSRbase, StateVar %in% SVs & dose_uM %in% doses),
            aes(x = time, y = value, col = "Model"), linewidth = 1.5) +
    facet_grid(cols = vars(dose_uM), rows = vars(StateVar), scales = "free") +
  scale_color_manual(name = "", breaks = c("Model", "Mean", "Unadapted model"),
                       values = c("Model" = "firebrick", "Mean" = "black",
                                  "Unadapted model" = "royalblue")) +
  xlab("Time (hours)") + ylab("GFP intensity") + theme(legend.position = "bottom") +
  labs(shape = "Replicate") + guides(color=guide_legend(nrow=2,byrow=TRUE))

print(Figure2b)

if(SaveFigures == 1){
  ggsave("Lecture2.svg", plot = Figure2b, path = "..//Figures//Lecture", width = 12,
         height = 12, units = "cm", dpi = 300)
}

```

### Figure S4: all doses OSR model simulation

Plotting of the base OSR model for exposure to all concentrations DEM.

```{r}
SVs = c("NRF2", "SRXN1")
doses = unique(measurements_DEM$dose_uM)

FigureS4 = ggplot() + theme_bw() +
  geom_point(data = filter(measurements_DEM, StateVar %in% SVs & dose_uM %in% doses), 
             aes(x = timeAfterExposure, y = data4modelReal, shape = as.factor(replID)), 
             color = "dark grey") + 
  geom_line(data = filter(mean_DEM, StateVar %in% SVs & dose_uM %in% doses), 
            aes(x = timepoints, y = mean_interpol, col = "Mean"), linewidth = 1.5) +
  geom_line(data = filter(modeldata_OSRunadapted, StateVar %in% SVs & dose_uM %in% doses), 
            aes(x = time, y = value, col = "Unadapted model"), linewidth = 1.5) +
  geom_line(data = filter(modeldata_OSRbase, StateVar %in% SVs & dose_uM %in% doses), 
            aes(x = time, y = value, col = "Adapted model"), linewidth = 1.5) +
  facet_grid(cols = vars(dose_uM), rows = vars(StateVar), scales = "free") +
  scale_color_manual(name = "", breaks = c("Mean", "Adapted model", "Unadapted model"),
                       values = c("Mean" = "black", "Adapted model" = "firebrick",
                                  "Unadapted model" = "royalblue")) +
  xlab("Time (hours)") + ylab("GFP intensity") + 
  labs(shape = "Replicate")

print(FigureS4)

if(SaveFigures == 1){
  ggsave("FigureS4.pdf", plot = FigureS4, path = "..//Figures", width = 30,
         height = 10, units = "cm", dpi = 300)
}
```

## Figure 2c: effect DEM on P53 & MDM2

This figure shows for each concentration of DEM the effect on MDM2 and P53 over time.

```{r}
Figure2c = ggplot(data = filter(mean_ETO, StateVar == "p53" | StateVar == "MDM2" | StateVar == "p21" | StateVar == "BTG2" )) +
  theme_bw() +
  geom_ribbon(aes(x = timepoints, ymin = mean_interpol-sd_interpol, 
                  ymax = mean_interpol+sd_interpol, fill = as.factor(dose_uM)), 
              alpha = 0.2) +
  geom_line(aes(x = timepoints, y = mean_interpol, color = as.factor(dose_uM)), 
            linewidth=1) + expand_limits(x = 0, y = 0) +
  facet_wrap(vars(StateVar), scales = "free", nrow = 1) + xlab("Time (hours)") + ylab("GFP intensity") + 
  labs(color = expression(paste("Dose (", mu, "M)")), 
       fill = expression(paste("Dose (", mu, "M)")))
  
  print(Figure2c)

  if(SaveFigures == 1){
  ggsave("Lecture4.svg", plot = Figure2c, path = "..//Figures//Lecture", width = 30,
         height = 9, units = "cm", dpi = 300)
  }
  
```

### Figure S5: effect DEM on BTG2 & p21

This figure shows for each concentration of DEM the effect on BTG2 and p21 over time.

```{r}
FigureS5 = ggplot(data = filter(mean_DEM, StateVar == "p21" | StateVar == "BTG2")) +
  theme_bw() +
  geom_ribbon(aes(x = timepoints, ymin = mean_interpol-sd_interpol, 
                  ymax = mean_interpol+sd_interpol, fill = as.factor(dose_uM)), 
              alpha = 0.2) +
  geom_line(aes(x = timepoints, y = mean_interpol, color = as.factor(dose_uM)), 
            linewidth=1) + expand_limits(x = 0, y = 0) +
  facet_wrap(vars(StateVar)) + xlab("Time (hours)") + ylab("GFP intensity") + 
  labs(color = expression(paste("Dose (", mu, "M)")), 
       fill = expression(paste("Dose (", mu, "M)")))
  
  print(FigureS5)
  
    if(SaveFigures == 1){
  ggsave("FigureS5.pdf", plot = FigureS5, path = "..//Figures", width = 20,
         height = 10, units = "cm", dpi = 300)
  }
```

# Crosstalk model ETO

Simulation of different crosstalk models for exposure to etoposide.

```{r}
inistate_combi = c(inistate_DDR, inistate_OSR)

#Model E0
simu_pars_E0 = simu_pars_DDRbase %>%
  rename(value1 = est_value) %>%
  select(-init_value) %>%
  full_join(simu_pars_OSRbase) %>%
  rename(value2 = est_value) %>%
  mutate(est_value = ifelse(is.na(value1), value2, value1)) %>%
  select(-init_value) %>%
  select(c(X,est_value))
modeldata_E0 = include_p53(run_model(Model_E0, tspan, doses_ETO, ECs_ETO, 
                                     inistate_combi,simu_pars_E0$X, 
                                     simu_pars_E0$est_value))

#Model E1
file = list.files("..//FittingResults", pattern='ModelE1')
simu_pars_E1 = read.csv(file  = paste("..//FittingResults//", file, sep = ""), 
                             header = TRUE) %>%
  rename(value1 = est_value) %>%
  select(-init_value) %>%
  full_join(simu_pars_E0) %>%
  rename(value2 = est_value) %>%
  mutate(est_value = ifelse(is.na(value1), value2, value1)) %>%
  select(c(X,est_value))
modeldata_E1 = include_p53(run_model(Model_E1, tspan, doses_ETO, ECs_ETO, 
                                     inistate_combi,simu_pars_E1$X,
                                     simu_pars_E1$est_value))

#Model E2
file = list.files("..//FittingResults", pattern='ModelE2')
simu_pars_E2 = read.csv(file  = paste("..//FittingResults//", file, sep = ""), 
                             header = TRUE) %>%
  rename(value1 = est_value) %>%
  select(-init_value) %>%
  full_join(simu_pars_E0) %>%
  rename(value2 = est_value) %>%
  mutate(est_value = ifelse(is.na(value1), value2, value1)) %>%
  select(c(X,est_value))
modeldata_E2 = include_p53(run_model(Model_E2, tspan, doses_ETO, ECs_ETO, 
                                     inistate_combi,simu_pars_E2$X,
                                     simu_pars_E2$est_value))

#Model E3
file = list.files("..//FittingResults", pattern='ModelE3')
simu_pars_E3 = read.csv(file  = paste("..//FittingResults//", file, sep = ""), 
                             header = TRUE) %>%
  rename(value1 = est_value) %>%
  select(-init_value) %>%
  full_join(simu_pars_E0) %>%
  rename(value2 = est_value) %>%
  mutate(est_value = ifelse(is.na(value1), value2, value1)) %>%
  select(c(X,est_value))
modeldata_E3 = include_p53(run_model(Model_E3, tspan, doses_ETO, ECs_ETO, 
                                     inistate_combi, simu_pars_E3$X,
                                     simu_pars_E3$est_value))

```

## Table 1: cost, AIC, BICfor models M-E1 to M-E3

Computation of cost, AIC and BIC for each model version.

```{r}
AIC_E0 = compute_AIC(measurements_ETO, c("NRF2", "SRXN1"), 0, Model_E0, doses_ETO,
                     ECs_ETO, inistate_combi,simu_pars_E0$X, simu_pars_E0$est_value)
AIC_E1 = compute_AIC(measurements_ETO, c("NRF2", "SRXN1"), 1, Model_E1, doses_ETO,
                     ECs_ETO, inistate_combi,simu_pars_E1$X, simu_pars_E1$est_value)
AIC_E2 = compute_AIC(measurements_ETO, c("NRF2", "SRXN1"), 1, Model_E2, doses_ETO,
                     ECs_ETO, inistate_combi,simu_pars_E2$X, simu_pars_E2$est_value)
AIC_E3 = compute_AIC(measurements_ETO, c("NRF2", "SRXN1"), 2, Model_E3, doses_ETO,
                     ECs_ETO,inistate_combi,simu_pars_E3$X, simu_pars_E3$est_value)
```

## Figure 3b: crosstalk models ETO - 2.5 & 25 uM

Plotting of the crosstalk models for exposure to 2.5 & 25 uM etoposide.

```{r}
SVs = c("NRF2", "SRXN1")
doses = c(2.5, 25)

Figure3b = ggplot() + theme_bw() +
  geom_point(data = filter(measurements_ETO, StateVar %in% SVs & dose_uM %in% doses), 
           aes(x = timeAfterExposure, y = data4modelReal, shape = as.factor(replID)), 
           color = "dark grey") +
  geom_line(data = filter(mean_ETO, StateVar %in% SVs &dose_uM %in% doses), 
            aes(x = timepoints, y = mean_interpol), col = "black", linewidth = 1.5) +
  geom_line(data = filter(modeldata_E0, StateVar %in% SVs & dose_uM %in% doses), 
            aes(x = time, y = value, col = "M-E0"), linewidth = 1.5) +
  geom_line(data = filter(modeldata_E1, StateVar %in% SVs & dose_uM %in% doses), 
            aes(x = time, y = value, col = "M-E1"), linewidth = 1.5) +
  geom_line(data = filter(modeldata_E2, StateVar %in% SVs & dose_uM %in% doses), 
              aes(x = time, y = value, col = "M-E2"), linewidth = 1.5) +
  geom_line(data = filter(modeldata_E3, StateVar %in% SVs & dose_uM %in% doses), 
              aes(x = time, y = value, col = "M-E3"), linewidth = 1.5) +
  facet_grid(cols = vars(dose_uM), rows = vars(StateVar), scales = "free") +
  scale_color_manual(name = "Model", breaks = c("M-E0", "M-E1", "M-E2", "M-E3"),
                     values = c("M-E0" = "firebrick", "M-E1" = "royalblue", 
                                "M-E2" = "goldenrod","M-E3" = "darkolivegreen")) +
  xlab("Time (hours)") + ylab("GFP intensity") + theme(legend.position = "bottom") +
  labs(shape = "Replicate") + guides(color=guide_legend(nrow=2,byrow=TRUE))

plot(Figure3b)

if(SaveFigures == 1){
  ggsave("Presentation3.svg", plot = Figure3b, path = "..//Figures//Poster", width = 12,
         height = 12, units = "cm", dpi = 300)
}
```

## Figure poster 1
```{r}
SVs = c("NRF2", "SRXN1", "MDM2", "p53")
doses = c(25)

Figure3b = ggplot() + theme_bw() +
  geom_point(data = filter(measurements_ETO, StateVar %in% SVs & dose_uM %in% doses), 
           aes(x = timeAfterExposure, y = data4modelReal, shape = as.factor(replID)), 
           color = "dark grey") +
  geom_line(data = filter(mean_ETO, StateVar %in% SVs &dose_uM %in% doses), 
            aes(x = timepoints, y = mean_interpol), col = "black", linewidth = 1.5) +
  geom_line(data = filter(modeldata_E1, StateVar %in% SVs & dose_uM %in% doses), 
            aes(x = time, y = value, col = "M-E1"), linewidth = 1.5) +
  geom_line(data = filter(modeldata_E2, StateVar %in% SVs & dose_uM %in% doses), 
              aes(x = time, y = value, col = "M-E2"), linewidth = 1.5) +
  geom_line(data = filter(modeldata_E3, StateVar %in% SVs & dose_uM %in% doses), 
              aes(x = time, y = value, col = "M-E3"), linewidth = 1.5) +
  geom_line(data = filter(modeldata_E0, StateVar %in% SVs & dose_uM %in% doses), 
            aes(x = time, y = value, col = "M-E0"), linewidth = 1.5) +
  facet_wrap(vars(StateVar), nrow = 1, scales = "free") + expand_limits(y = 0) +
  scale_color_manual(name = "Model", breaks = c("M-E0", "M-E1", "M-E2", "M-E3"),
                     values = c("M-E0" = "firebrick", "M-E1" = "royalblue", 
                                "M-E2" = "goldenrod","M-E3" = "darkolivegreen")) +
  xlab("Time (hours)") + ylab("GFP intensity") +
  labs(shape = "Replicate", title = expression(paste("Etoposide (25 ", mu, "M)")))

plot(Figure3b)

if(SaveFigures == 1){
  ggsave("Poster//Figure3b.png", plot = Figure3b, path = "..//Figures", width = 40,
         height = 8, units = "cm", dpi = 300)
}
```



### Figure S6: crosstalk models ETO - all concentrations

Plotting of the crosstalk models for exposure to all concentrations etoposide.

```{r}
SVs = c("NRF2", "SRXN1")
doses = doses_ETO

FigureS6 = ggplot() + theme_bw() +
  geom_point(data = filter(measurements_ETO, StateVar %in% SVs & dose_uM %in% doses),
             aes(x = timeAfterExposure, y = data4modelReal, shape = as.factor(replID)),
           color = "dark grey") + 
  geom_line(data = filter(mean_ETO, StateVar %in% SVs &dose_uM %in% doses), 
            aes(x = timepoints, y = mean_interpol), col = "black", linewidth = 1.5) +
  geom_line(data = filter(modeldata_E0, StateVar %in% SVs & dose_uM %in% doses), 
            aes(x = time, y = value, col = "M-E0"), linewidth = 1.5) +
  geom_line(data = filter(modeldata_E1, StateVar %in% SVs & dose_uM %in% doses),
            aes(x = time, y = value, col = "M-E1"), linewidth = 1.5) +
  geom_line(data = filter(modeldata_E2, StateVar %in% SVs & dose_uM %in% doses),
              aes(x = time, y = value, col = "M-E2"), linewidth = 1.5) +
  geom_line(data = filter(modeldata_E3, StateVar %in% SVs & dose_uM %in% doses),
              aes(x = time, y = value, col = "M-E3"), linewidth = 1.5) +
  facet_grid(cols = vars(dose_uM), rows = vars(StateVar), scales = "free") +
  scale_color_manual(name = "Model", breaks = c("M-E0", "M-E1", "M-E2", "M-E3"),
                     values = c("M-E0" = "firebrick", "M-E1" = "royalblue", 
                                "M-E2" = "goldenrod","M-E3" = "darkolivegreen")) +
  xlab("Time (hours)") + ylab("GFP intensity") + 
  labs(shape = "Replicate")

plot(FigureS6)

if(SaveFigures == 1){
  ggsave("FigureS6.pdf", plot = FigureS6, path = "..//Figures", width = 30,
         height = 10, units = "cm", dpi = 300)
}
```

# Crosstalk model DEM

Simulation of different crosstalk models for exposure to DEM.

```{r}
#Model D0
simu_pars_D0 = simu_pars_OSRbase %>%
  rename(value1 = est_value) %>%
  select(-init_value) %>%
  full_join(simu_pars_DDRbase) %>%
  rename(value2 = est_value) %>%
  mutate(est_value = ifelse(is.na(value1), value2, value1)) %>%
  select(-init_value) %>%
  select(c(X,est_value))
modeldata_D0 = include_p53(run_model(Model_D0, tspan, doses_DEM, ECs_DEM, 
                                     inistate_combi, simu_pars_D0$X, 
                                     simu_pars_D0$est_value))

#Model D1
file = list.files("..//FittingResults", pattern='ModelD1')
simu_pars_D1 = read.csv(file  = paste("..//FittingResults//", file, sep = ""), 
                             header = TRUE) %>%
  rename(value1 = est_value) %>%
  select(-init_value) %>%
  full_join(simu_pars_D0) %>%
  rename(value2 = est_value) %>%
  mutate(est_value = ifelse(is.na(value1), value2, value1)) %>%
  select(c(X,est_value))
modeldata_D1 = include_p53(run_model(Model_D1, tspan, doses_DEM, ECs_DEM, 
                                     inistate_combi, simu_pars_D1$X, 
                                     simu_pars_D1$est_value))

# Model D2
file = list.files("..//FittingResults", pattern='ModelD2')
simu_pars_D2 = read.csv(file  = paste("..//FittingResults//", file, sep = ""),
                             header = TRUE) %>%
  rename(value1 = est_value) %>%
  select(-init_value) %>%
  full_join(simu_pars_D0) %>%
  rename(value2 = est_value) %>%
  mutate(est_value = ifelse(is.na(value1), value2, value1)) %>%
  select(c(X,est_value))
modeldata_D2 = include_p53(run_model(Model_D2, tspan, doses_DEM, ECs_DEM, 
                                     inistate_combi, simu_pars_D2$X, 
                                     simu_pars_D2$est_value))

#Model D3
file = list.files("..//FittingResults", pattern='ModelD3')
simu_pars_D3 = read.csv(file  = paste("..//FittingResults//", file, sep = ""), 
                             header = TRUE) %>%
  rename(value1 = est_value) %>%
  select(-init_value) %>%
  full_join(simu_pars_D0) %>%
  rename(value2 = est_value) %>%
  mutate(est_value = ifelse(is.na(value1), value2, value1)) %>%
  select(c(X,est_value))
modeldata_D3 = include_p53(run_model(Model_D3, tspan, doses_DEM, ECs_DEM, 
                                     inistate_combi, simu_pars_D3$X, 
                                     simu_pars_D3$est_value))

#Model D4
file = list.files("..//FittingResults", pattern='ModelD4')
simu_pars_D4 = read.csv(file  = paste("..//FittingResults//", file, sep = ""), 
                             header = TRUE) %>%
  rename(value1 = est_value) %>%
  select(-init_value) %>%
  full_join(simu_pars_D0) %>%
  rename(value2 = est_value) %>%
  mutate(est_value = ifelse(is.na(value1), value2, value1)) %>%
  select(c(X,est_value))
modeldata_D4 = include_p53(run_model(Model_D4, tspan, doses_DEM, ECs_DEM, 
                                     inistate_combi, simu_pars_D4$X, 
                                     simu_pars_D4$est_value))

#Model D5
file = list.files("..//FittingResults", pattern='ModelD5')
simu_pars_D5 = read.csv(file  = paste("..//FittingResults//", file, sep = ""), 
                             header = TRUE) %>%
  rename(value1 = est_value) %>%
  select(-init_value) %>%
  full_join(simu_pars_D0) %>%
  rename(value2 = est_value) %>%
  mutate(est_value = ifelse(is.na(value1), value2, value1)) %>%
  select(c(X,est_value))
modeldata_D5 = include_p53(run_model(Model_D5, tspan, doses_DEM, ECs_DEM, 
                                     inistate_combi, simu_pars_D5$X, 
                                     simu_pars_D5$est_value))

#Model D6
file = list.files("..//FittingResults", pattern='ModelD6')
simu_pars_D6 = read.csv(file  = paste("..//FittingResults//", file, sep = ""), 
                             header = TRUE) %>%
  rename(value1 = est_value) %>%
  select(-init_value) %>%
  full_join(simu_pars_D0) %>%
  rename(value2 = est_value) %>%
  mutate(est_value = ifelse(is.na(value1), value2, value1)) %>%
  select(c(X,est_value))
modeldata_D6 = include_p53(run_model(Model_D6, tspan, doses_DEM, ECs_DEM, 
                                     inistate_combi, simu_pars_D6$X, 
                                     simu_pars_D6$est_value))

```

## Table 2: cost, AIC, BIC for models M-D1 to M-D6

Computation of cost, AIC and BIC for each model version.

```{r}
AIC_D0 = compute_AIC(measurements_DEM, c("p53", "MDM2"), 0, Model_D0, doses_DEM,
                     ECs_DEM, inistate_combi,simu_pars_D0$X, simu_pars_D0$est_value)

AIC_D1 = compute_AIC(measurements_DEM, c("p53", "MDM2"), 5, Model_D1, doses_DEM,
                     ECs_DEM, inistate_combi,simu_pars_D1$X, simu_pars_D1$est_value)
AIC_D2 = compute_AIC(measurements_DEM, c("p53", "MDM2"), 4, Model_D2, doses_DEM,
                     ECs_DEM, inistate_combi,simu_pars_D2$X, simu_pars_D2$est_value)
AIC_D3 = compute_AIC(measurements_DEM, c("p53", "MDM2"), 6, Model_D3, doses_DEM,
                     ECs_DEM, inistate_combi,simu_pars_D3$X, simu_pars_D3$est_value)
AIC_D4 = compute_AIC(measurements_DEM, c("p53", "MDM2"), 11, Model_D4, doses_DEM,
                     ECs_DEM, inistate_combi,simu_pars_D4$X, simu_pars_D4$est_value)
AIC_D5 = compute_AIC(measurements_DEM, c("p53", "MDM2"), 10, Model_D5, doses_DEM,
                     ECs_DEM, inistate_combi,simu_pars_D5$X, simu_pars_D5$est_value)
AIC_D6 = compute_AIC(measurements_DEM, c("p53", "MDM2"), 12, Model_D6, doses_DEM,
                     ECs_DEM, inistate_combi,simu_pars_D6$X, simu_pars_D6$est_value)
```

## Figure 4bc: crosstalk models DEM - 10 & 200 uM

Plotting of the crosstalk models for exposure to 20 & 200 uM DEM.

```{r}
SVs = c("p53", "MDM2")
doses = c(20,200)

Figure4b = ggplot() + theme_bw() +
  geom_point(data = filter(measurements_DEM, StateVar %in% SVs & dose_uM %in% doses),
             aes(x = timeAfterExposure, y = data4modelReal, 
                 shape = as.factor(replID)),color = "dark grey") + 
  geom_line(data = filter(mean_DEM, StateVar %in% SVs & dose_uM %in% doses), 
            aes(x = timepoints, y = mean_interpol), col = "black", 
            linewidth = 1.5) +
  geom_line(data = filter(modeldata_D0, StateVar %in% SVs & dose_uM %in% doses),
            aes(x = time, y = value, col = "M-D0"), linewidth = 1.5) +
  geom_line(data = filter(modeldata_D1, StateVar %in% SVs & dose_uM %in% doses),
            aes(x = time, y = value, col = "M-D1"), linewidth = 1.5) +
  geom_line(data = filter(modeldata_D2, StateVar %in% SVs & dose_uM %in% doses),
              aes(x = time, y = value, col = "M-D2"), linewidth = 1.5) +
  geom_line(data = filter(modeldata_D3, StateVar %in% SVs & dose_uM %in% doses),
              aes(x = time, y = value, col = "M-D3"), linewidth = 1.5) +
  facet_grid(cols = vars(dose_uM), rows = vars(StateVar), scales = "free") +
  scale_color_manual(name = "Model", breaks = c("M-D0", "M-D1", "M-D2", "M-D3"),
                     values = c("M-D0" = "firebrick", "M-D1" = "mediumorchid", 
                                "M-D2" = "darkorange","M-D3" = "darkolivegreen")) +
  xlab("Time (hours)") + ylab("GFP intensity") + theme(legend.position = "bottom") +
  labs(shape = "Replicate") + guides(color=guide_legend(nrow=2,byrow=TRUE), 
                                     shape = guide_legend(nrow=2,byrow=TRUE))

plot(Figure4b)

Figure4c = ggplot() + theme_bw() +
  geom_point(data = filter(measurements_DEM, StateVar %in% SVs & dose_uM %in% doses),
             aes(x = timeAfterExposure, y = data4modelReal, shape = as.factor(replID)),
           color = "dark grey") + 
  geom_line(data = filter(mean_DEM, StateVar %in% SVs & dose_uM %in% doses), 
            aes(x = timepoints, y = mean_interpol), col = "black", linewidth = 1.5) +
  geom_line(data = filter(modeldata_D4, StateVar %in% SVs & dose_uM %in% doses),
            aes(x = time, y = value, col = "M-D4"), linewidth = 2, linetype = "solid") +
  geom_line(data = filter(modeldata_D5, StateVar %in% SVs & dose_uM %in% doses),
              aes(x = time, y = value, col = "M-D5"), linewidth = 1.5, linetype = "solid") +
  geom_line(data = filter(modeldata_D6, StateVar %in% SVs & dose_uM %in% doses),
              aes(x = time, y = value, col = "M-D6"), linewidth = 1.5, linetype = "solid") +
  facet_grid(cols = vars(dose_uM), rows = vars(StateVar), scales = "free") +
  scale_color_manual(name = "Model", breaks = c("M-D4", "M-D5", "M-D6"),
                     values = c("M-D0" = "firebrick","M-D4" = "mediumorchid", 
                                "M-D5" = "darkorange","M-D6" = "darkolivegreen")) +
  xlab("Time (hours)") + ylab("GFP intensity") + theme(legend.position = "bottom") +
  labs(shape = "Replicate") + guides(color=guide_legend(nrow=2,byrow=TRUE), 
                                     shape = guide_legend(nrow=2,byrow=TRUE))

plot(Figure4c)

if(SaveFigures == 1){
  ggsave("Figure4b.svg", plot = Figure4b, path = "..//Figures", width = 12,
         height = 12, units = "cm", dpi = 300)
  ggsave("Figure4c.svg", plot = Figure4c, path = "..//Figures", width = 12,
         height = 12, units = "cm", dpi = 300)
}
```

## Figure poster 3
```{r}
SVs = c("NRF2", "SRXN1", "MDM2", "p53")
doses = c(200)

FigureP3 = ggplot() + theme_bw() +
  geom_point(data = filter(measurements_DEM, StateVar %in% SVs & dose_uM %in% doses), 
           aes(x = timeAfterExposure, y = data4modelReal, shape = as.factor(replID)), 
           color = "dark grey") +
  geom_line(data = filter(mean_DEM, StateVar %in% SVs &dose_uM %in% doses), 
            aes(x = timepoints, y = mean_interpol), col = "black", linewidth = 1.5) +
  geom_line(data = filter(modeldata_D4, StateVar %in% SVs & dose_uM %in% doses), 
            aes(x = time, y = value, col = "M-D4"), linewidth = 1.5) +
  geom_line(data = filter(modeldata_D5, StateVar %in% SVs & dose_uM %in% doses), 
              aes(x = time, y = value, col = "M-D5"), linewidth = 1.5) +
  geom_line(data = filter(modeldata_D6, StateVar %in% SVs & dose_uM %in% doses), 
              aes(x = time, y = value, col = "M-D6"), linewidth = 1.5) +
  geom_line(data = filter(modeldata_D0, StateVar %in% SVs & dose_uM %in% doses), 
            aes(x = time, y = value, col = "M-D0"), linewidth = 1.5) +
  facet_wrap(vars(StateVar), nrow = 1, scales = "free") + expand_limits(y = 0) +
  scale_color_manual(name = "Model", breaks = c("M-D0","M-D4", "M-D5", "M-D6"),
                     values = c("M-D0" = "firebrick","M-D4" = "mediumorchid", 
                                "M-D5" = "darkorange","M-D6" = "darkolivegreen")) +
  xlab("Time (hours)") + ylab("GFP intensity") +
  labs(shape = "Replicate", title = expression(paste("DEM (200 ", mu, "M)")))

plot(FigureP3)

if(SaveFigures == 1){
  ggsave("Poster//FigureP3.png", plot = FigureP3, path = "..//Figures", width = 40,
         height = 8, units = "cm", dpi = 300)
}
```

### Figure S7ab: crosstalk models DEM - all concentrations

Plotting of the crosstalk models for exposure to all concentrations DEM.

```{r}
SVs = c("p53", "MDM2")
doses = doses_DEM

FigureS7a = ggplot() + theme_bw() +
  geom_point(data = filter(measurements_DEM, StateVar %in% SVs & dose_uM %in% doses),
             aes(x = timeAfterExposure, y = data4modelReal, shape = as.factor(replID)),
           color = "dark grey") + 
  geom_line(data = filter(mean_DEM, StateVar %in% SVs &dose_uM %in% doses), 
            aes(x = timepoints, y = mean_interpol), col = "black", linewidth = 1.5) +
  geom_line(data = filter(modeldata_D0, StateVar %in% SVs & dose_uM %in% doses),
            aes(x = time, y = value, col = "M-D0"), linewidth = 1.5) +
  geom_line(data = filter(modeldata_D1, StateVar %in% SVs & dose_uM %in% doses),
            aes(x = time, y = value, col = "M-D1"), linewidth = 1.5) +
  geom_line(data = filter(modeldata_D2, StateVar %in% SVs & dose_uM %in% doses),
              aes(x = time, y = value, col = "M-D2"), linewidth = 1.5) +
  geom_line(data = filter(modeldata_D3, StateVar %in% SVs & dose_uM %in% doses),
              aes(x = time, y = value, col = "M-D3"), linewidth = 1.5) +
  facet_grid(cols = vars(dose_uM), rows = vars(StateVar), scales = "free") +
  scale_color_manual(name = "Model", breaks = c("M-D0", "M-D1", "M-D2", "M-D3"),
                     values = c("M-D0" = "firebrick", "M-D1" = "mediumorchid", 
                                "M-D2" = "darkorange","M-D3" = "darkolivegreen")) +
  xlab("Time (hours)") + ylab("GFP intensity") + 
  labs(shape = "Replicate")

plot(FigureS7a)

FigureS7b = ggplot() + theme_bw() +
  geom_point(data = filter(measurements_DEM, StateVar %in% SVs & dose_uM %in% doses),
             aes(x = timeAfterExposure, y = data4modelReal, shape = as.factor(replID)),
           color = "dark grey") + 
  geom_line(data = filter(mean_DEM, StateVar %in% SVs &dose_uM %in% doses), 
            aes(x = timepoints, y = mean_interpol), col = "black", linewidth = 1.5) +
  geom_line(data = filter(modeldata_D4, StateVar %in% SVs & dose_uM %in% doses),
            aes(x = time, y = value, col = "M-D4"), linewidth = 1.5) +
  geom_line(data = filter(modeldata_D5, StateVar %in% SVs & dose_uM %in% doses),
              aes(x = time, y = value, col = "M-D5"), linewidth = 1.5) +
  geom_line(data = filter(modeldata_D6, StateVar %in% SVs & dose_uM %in% doses),
              aes(x = time, y = value, col = "M-D6"), linewidth = 1.5) +
  facet_grid(cols = vars(dose_uM), rows = vars(StateVar), scales = "free") +
  scale_color_manual(name = "Model", breaks = c("M-D0", "M-D4", "M-D5", "M-D6"),
                     values = c("M-D0" = "firebrick", "M-D4" = "mediumorchid", 
                                "M-D5" = "darkorange","M-D6" = "darkolivegreen")) +
  xlab("Time (hours)") + ylab("GFP intensity") + 
  labs(shape = "Replicate")

plot(FigureS7b)

if(SaveFigures == 1){
  ggsave("FigureS7a.svg", plot = FigureS7a, path = "..//Figures", width = 30,
         height = 10, units = "cm", dpi = 300)
  ggsave("FigureS7b.svg", plot = FigureS7b, path = "..//Figures", width = 30,
         height = 10, units = "cm", dpi = 300)
}
```
### Figure S8: Adapted MDM2 production

Simulation of model M-D3 with 8x higher maximal production of MDM2 via NRF2.

```{r}
file = list.files("..//FittingResults", pattern='ModelD3')
simu_pars_D3_2 = read.csv(file  = paste("..//FittingResults//", file, sep = ""), 
                             header = TRUE) %>%
  rename(value1 = est_value) %>%
  select(-init_value) %>%
  full_join(simu_pars_D0) %>%
  rename(value2 = est_value) %>%
  mutate(est_value = ifelse(is.na(value1), value2, value1)) %>%
  select(c(X,est_value))

simu_pars_D3_2$est_value[simu_pars_D3_2$X == "VmaxM2_byN2"] = 8*simu_pars_D3_2$est_value[simu_pars_D3_2$X == "VmaxM2_byN2"]

modeldata_D3_2 = include_p53(run_model(Model_D3, tspan, doses_DEM, ECs_DEM, 
                                     inistate_combi, simu_pars_D3_2$X, 
                                     simu_pars_D3_2$est_value))

SVs = c("p53", "MDM2")
doses = c(20,200)

FigureS8 = ggplot() + theme_bw() +
  geom_point(data = filter(measurements_DEM, StateVar %in% SVs & dose_uM %in% doses),
             aes(x = timeAfterExposure, y = data4modelReal, 
                 shape = as.factor(replID)),color = "dark grey") + 
  geom_line(data = filter(mean_DEM, StateVar %in% SVs & dose_uM %in% doses), 
            aes(x = timepoints, y = mean_interpol, col = "Mean"), 
            linewidth = 1.5) +
  geom_line(data = filter(modeldata_D3_2, StateVar %in% SVs & dose_uM %in% doses),
              aes(x = time, y = value, col = "Simulation"), linewidth = 1.5) +
  facet_grid(cols = vars(dose_uM), rows = vars(StateVar), scales = "free") +
  scale_color_manual(name = "", breaks = c("Mean", "Simulation"),
                     values = c("Mean" = "black","Simulation" = "cyan4")) +
  xlab("Time (hours)") + ylab("GFP intensity") + 
  labs(shape = "Replicate")

plot(FigureS8)

if(SaveFigures == 1){
  ggsave("FigureS8.pdf", plot = FigureS8, path = "..//Figures", width = 15,
         height = 10, units = "cm", dpi = 300)
}

```

# Combined & knock-down model

Simulation of the combined models.

```{r}
tspan_pre <-  seq(0, 5000, by = 1)

simu_pars_CE = simu_pars_E1 %>%
  add_row(X = "VmaxM2_byN2", est_value = simu_pars_D4$est_value[simu_pars_D4$X=="VmaxM2_byN2"]) %>%
  add_row(X = "hillM2_byN2", est_value = simu_pars_D4$est_value[simu_pars_D4$X=="hillM2_byN2"]) %>%
  add_row(X = "KmM2_byN2", est_value = simu_pars_D4$est_value[simu_pars_D4$X=="KmM2_byN2"])


ic = modeldose(Model_CE, 0, tspan_pre, inistate_combi, simu_pars_CE$X, 
               simu_pars_CE$est_value)
modeldata_CE = include_p53(run_model(Model_CE, tspan, doses_ETO, ECs_ETO, 
                                     ic[nrow(ic),3:ncol(ic)], simu_pars_CE$X, 
                                     simu_pars_CE$est_value))

simu_pars_CD = simu_pars_D4 %>%
  add_row(X = "ct_M15", est_value = simu_pars_E1$est_value[simu_pars_E1$X=="ct_M15"])

ic = modeldose(Model_CD, 0, tspan_pre, inistate_combi, simu_pars_CD$X, 
               simu_pars_CD$est_value)
modeldata_CD = include_p53(run_model(Model_CD, tspan, doses_DEM, ECs_DEM, 
                                     ic[nrow(ic),3:ncol(ic)], simu_pars_CD$X, 
                                     simu_pars_CD$est_value))
```

## Figure 5ab: combined models

Plotting of the combined models for 25 uM etoposide and 200 uM DEM.

```{r}
SVs = c("NRF2", "SRXN1","p53", "MDM2")

doses = 25
Figure5a = ggplot() + theme_bw() +
  geom_point(data = filter(measurements_ETO, StateVar %in% SVs & dose_uM %in% doses),
             aes(x = timeAfterExposure, y = data4modelReal, shape = as.factor(replID)),
           color = "dark grey") + 
  geom_line(data = filter(mean_ETO, StateVar %in% SVs & dose_uM %in% doses), 
            aes(x = timepoints, y = mean_interpol), col = "black", linewidth = 1.5) +
  geom_line(data = filter(modeldata_E1, StateVar %in% SVs & dose_uM %in% doses),
            aes(x = time, y = value, col = "M-E1"), linewidth = 2, linetype = "solid") +
  geom_line(data = filter(modeldata_CE, StateVar %in% SVs & dose_uM %in% doses),
              aes(x = time, y = value, col = "M-CE"), linewidth = 1.5, linetype = "solid") +
  facet_wrap(vars(StateVar), scales = "free", nrow=1) +
  scale_color_manual(name = "Model", breaks = c("M-E1", "M-CE"),
                     values = c("M-E1" = "royalblue", "M-CE" = "firebrick")) +
  xlab("Time (hours)") + ylab("GFP intensity") + 
  labs(shape = "Replicate", title = expression(paste("Etoposide (25 ", mu, "M)")))
plot(Figure5a)

doses = 200
Figure5b = ggplot() + theme_bw() +
  geom_point(data = filter(measurements_DEM, StateVar %in% SVs & dose_uM %in% doses),
             aes(x = timeAfterExposure, y = data4modelReal, shape = as.factor(replID)),
           color = "dark grey") + 
  geom_line(data = filter(mean_DEM, StateVar %in% SVs & dose_uM %in% doses), 
            aes(x = timepoints, y = mean_interpol), col = "black", linewidth = 1.5) +
  geom_line(data = filter(modeldata_D4, StateVar %in% SVs & dose_uM %in% doses),
            aes(x = time, y = value, col = "M-D4"), linewidth = 2, linetype = "solid") +
  geom_line(data = filter(modeldata_CD, StateVar %in% SVs & dose_uM %in% doses),
              aes(x = time, y = value, col = "M-DE"), linewidth = 1.5, linetype = "solid") +
  facet_wrap(vars(StateVar), scales = "free", nrow=1) + 
  scale_color_manual(name = "Model", breaks = c("M-D4", "M-DE"),
                     values = c("M-D4" = "mediumorchid", "M-DE" = "firebrick")) +
  xlab("Time (hours)") + ylab("GFP intensity") + 
  labs(shape = "Replicate", title =  expression(paste("DEM (200 ", mu, "M)")))
plot(Figure5b)

if(SaveFigures == 1){
  ggsave("Figure5a.svg", plot = Figure5a, path = "..//Figures", width = 29.45,
         height = 7, units = "cm", dpi = 300)
  ggsave("Figure5b.svg", plot = Figure5b, path = "..//Figures", width = 29.45,
         height = 7, units = "cm", dpi = 300)
}
```

### Figure S9: combined model all doses

Plotting of the combined models forall concentrations of etoposide and DEM.

```{r}
SVs = c("NRF2", "SRXN1","p53", "MDM2")

doses = doses_ETO
FigureS9a = ggplot() + theme_bw() +
  geom_point(data = filter(measurements_ETO, StateVar %in% SVs & dose_uM %in% doses),
             aes(x = timeAfterExposure, y = data4modelReal, shape = as.factor(replID)),
           color = "dark grey") + 
  geom_line(data = filter(mean_ETO, StateVar %in% SVs & dose_uM %in% doses), 
            aes(x = timepoints, y = mean_interpol), col = "black", linewidth = 1.5) +
  geom_line(data = filter(modeldata_E1, StateVar %in% SVs & dose_uM %in% doses),
            aes(x = time, y = value, col = "M-E1"), linewidth = 2, linetype = "solid") +
  geom_line(data = filter(modeldata_CE, StateVar %in% SVs & dose_uM %in% doses),
              aes(x = time, y = value, col = "M-CE"), linewidth = 1.5, linetype = "solid") +
  facet_grid(cols = vars(dose_uM), rows = vars(StateVar), scales = "free") +
  scale_color_manual(name = "Model", breaks = c("M-E1", "M-CE"),
                     values = c("M-E1" = "royalblue", "M-CE" = "firebrick")) +
  xlab("Time (hours)") + ylab("GFP intensity") + 
  labs(shape = "Replicate", title = "Etoposide")
plot(FigureS9a)

doses = doses_DEM
FigureS9b = ggplot() + theme_bw() +
  geom_point(data = filter(measurements_DEM, StateVar %in% SVs & dose_uM %in% doses),
             aes(x = timeAfterExposure, y = data4modelReal, shape = as.factor(replID)),
           color = "dark grey") + 
  geom_line(data = filter(mean_DEM, StateVar %in% SVs & dose_uM %in% doses), 
            aes(x = timepoints, y = mean_interpol), col = "black", linewidth = 1.5) +
  geom_line(data = filter(modeldata_D4, StateVar %in% SVs & dose_uM %in% doses),
            aes(x = time, y = value, col = "M-D4"), linewidth = 2, linetype = "solid") +
  geom_line(data = filter(modeldata_CD, StateVar %in% SVs & dose_uM %in% doses),
              aes(x = time, y = value, col = "M-DE"), linewidth = 1.5, linetype = "solid") +
  facet_grid(cols = vars(dose_uM), rows = vars(StateVar), scales = "free") +
  scale_color_manual(name = "Model", breaks = c("M-D4", "M-DE"),
                     values = c("M-D4" = "mediumorchid", "M-DE" = "firebrick")) +
  xlab("Time (hours)") + ylab("GFP intensity") + 
  labs(shape = "Replicate", title = "DEM")
plot(FigureS9b)

if(SaveFigures == 1){
  ggsave("FigureS9a.svg", plot = FigureS9a, path = "..//Figures", width = 30,
         height = 20, units = "cm", dpi = 300)
  ggsave("FigureS9b.svg", plot = FigureS9b, path = "..//Figures", width = 30,
         height = 20, units = "cm", dpi = 300)
}

```

Simulation of the knock-down models.

```{r}
eff = 0.3
KD_pars = c("KD_P53", "KD_P21", "KD_M2", "KD_N2")
KD_names = c("KD p53", "KD p21", "KD MDM2", "KD NRF2")
  
simu_pars_CEKD = simu_pars_CE %>%
  add_row(X = KD_pars, est_value = c(1,1,1,1))
simu_pars_CDKD = simu_pars_CD %>%
  add_row(X = KD_pars, est_value = c(1,1,1,1))

for (i in 1:length(KD_pars)){
  simu_pars_CEKD_temp = simu_pars_CEKD
  simu_pars_CEKD_temp$est_value[simu_pars_CEKD_temp$X == KD_pars[i]] = eff
  simu_pars_CDKD_temp = simu_pars_CDKD
  simu_pars_CDKD_temp$est_value[simu_pars_CDKD_temp$X == KD_pars[i]] = eff
  
  ic = modeldose(Model_CEKD, 0, tspan_pre, inistate_combi, simu_pars_CEKD_temp$X, 
               simu_pars_CEKD_temp$est_value)
  modeldata_CEKD = include_p53(run_model(Model_CEKD, tspan, doses_ETO, ECs_ETO, 
                                     ic[nrow(ic),3:ncol(ic)], simu_pars_CEKD_temp$X, 
                                     simu_pars_CEKD_temp$est_value)) %>%
    add_column(KD = KD_names[i])
  
  ic = modeldose(Model_CDKD, 0, tspan_pre, inistate_combi, simu_pars_CDKD_temp$X, 
               simu_pars_CDKD_temp$est_value)
  modeldata_CDKD = include_p53(run_model(Model_CDKD, tspan, doses_DEM, ECs_DEM, 
                                     ic[nrow(ic),3:ncol(ic)], simu_pars_CDKD_temp$X, 
                                     simu_pars_CDKD_temp$est_value))%>%
    add_column(KD = KD_names[i])
  
  if (i==1){
    modeldata_CEKD_all = modeldata_CEKD
    modeldata_CDKD_all = modeldata_CDKD
  } else {
    modeldata_CEKD_all = rbind(modeldata_CEKD_all, modeldata_CEKD)
    modeldata_CDKD_all = rbind(modeldata_CDKD_all, modeldata_CDKD)
  }
}

```

## Figure 5cd: knock-down model

Plotting of the kncok-down models for 25 uM etoposide and 200 uM DEM.

```{r}
SVs = c("NRF2", "SRXN1","p53", "MDM2")

doses = 25
Figure5c = ggplot() + theme_bw() +
  geom_line(data = filter(modeldata_CEKD_all, StateVar %in% SVs & dose_uM %in% doses),
            aes(x = time, y = value, col = KD), linewidth = 1.5, linetype = "solid") +
  geom_line(data = filter(modeldata_CE, StateVar %in% SVs & dose_uM %in% doses),
              aes(x = time, y = value), col = "black", linewidth = 1, linetype = "solid") +
  # facet_grid(cols = vars(dose_uM), rows = vars(StateVar), scales = "free") +
  facet_wrap(vars(StateVar), scales = "free", nrow=1) +
  # theme(legend.position="none") +
  xlab("Time (hours)") + ylab("GFP intensity") + 
  labs(color = "Knock-Down", title = expression(paste("Etoposide (25 ", mu, "M)")))
plot(Figure5c)

doses = 200
Figure5d = ggplot() + theme_bw() +
  geom_line(data = filter(modeldata_CDKD_all, StateVar %in% SVs & dose_uM %in% doses),
            aes(x = time, y = value, col = KD), linewidth = 1.5, linetype = "solid") +
  geom_line(data = filter(modeldata_CD, StateVar %in% SVs & dose_uM %in% doses),
              aes(x = time, y = value), col = "black", linewidth = 1, linetype = "solid") +
  # facet_grid(cols = vars(dose_uM), rows = vars(StateVar), scales = "free") +
  facet_wrap(vars(StateVar), scales = "free", nrow=1) +
  # theme(legend.position="none") +
  xlab("Time (hours)") + ylab("GFP intensity") + 
  labs(color = "Knock-Down", title = expression(paste("DEM (200 ", mu, "M)")))
plot(Figure5d)

if(SaveFigures == 1){
  ggsave("Figure5c.svg", plot = Figure5c, path = "..//Figures", width = 30,
         height = 7, units = "cm", dpi = 300)
  ggsave("Figure5d.svg", plot = Figure5d, path = "..//Figures", width = 30,
         height = 7, units = "cm", dpi = 300)
}
```
# Figures 2 and 4 for poster
```{r}
SVs = c("NRF2", "SRXN1","p53", "MDM2")

doses = 25
Figure5c = ggplot() + theme_bw() +
  geom_line(data = filter(modeldata_CEKD_all, StateVar %in% SVs & dose_uM %in% doses),
            aes(x = time, y = value, col = KD), linewidth = 1.5, linetype = "solid") +
  geom_line(data = filter(modeldata_CE, StateVar %in% SVs & dose_uM %in% doses),
              aes(x = time, y = value), col = "black", linewidth = 1, linetype = "solid") +
  # facet_grid(cols = vars(dose_uM), rows = vars(StateVar), scales = "free") +
  facet_wrap(vars(StateVar), scales = "free", nrow=1) + expand_limits(y = 0) +
  # theme(legend.position="none") +
  xlab("Time (hours)") + ylab("GFP intensity") + 
  labs(color = "Knock-Down") #, title = expression(paste("Etoposide (25 ", mu, "M)")))
plot(Figure5c)

doses = 200
Figure5d = ggplot() + theme_bw() +
  geom_line(data = filter(modeldata_CDKD_all, StateVar %in% SVs & dose_uM %in% doses),
            aes(x = time, y = value, col = KD), linewidth = 1.5, linetype = "solid") +
  geom_line(data = filter(modeldata_CD, StateVar %in% SVs & dose_uM %in% doses),
              aes(x = time, y = value), col = "black", linewidth = 1, linetype = "solid") +
  # facet_grid(cols = vars(dose_uM), rows = vars(StateVar), scales = "free") +
  facet_wrap(vars(StateVar), scales = "free", nrow=1) + expand_limits(y = 0) +
  # theme(legend.position="none") +
  xlab("Time (hours)") + ylab("GFP intensity") + 
  labs(color = "Knock-Down") #, title = expression(paste("DEM (200 ", mu, "M)")))
plot(Figure5d)

if(SaveFigures == 1){
  ggsave("Poster//Figure5c.png", plot = Figure5c, path = "..//Figures", width = 27,
         height = 7, units = "cm", dpi = 300)
  ggsave("Poster//Figure5d.png", plot = Figure5d, path = "..//Figures", width = 27,
         height = 7, units = "cm", dpi = 300)
}
```

### Figure S10: knock-down model all doses

Plotting of the knock-down models for all concentrations etoposide and DEM.

```{r}
SVs = c("NRF2", "SRXN1","p53", "MDM2")

doses = doses_ETO
FigureS10a = ggplot() + theme_bw() +
  geom_line(data = filter(modeldata_CEKD_all, StateVar %in% SVs & dose_uM %in% doses),
            aes(x = time, y = value, col = KD), linewidth = 1.5, linetype = "solid") +
  geom_line(data = filter(modeldata_CE, StateVar %in% SVs & dose_uM %in% doses),
              aes(x = time, y = value), col = "black", linewidth = 1, linetype = "solid") +
  facet_grid(cols = vars(dose_uM), rows = vars(StateVar), scales = "free") +
  xlab("Time (hours)") + ylab("GFP intensity") + 
  labs(color = "Knock-Down", title = "Etoposide")
plot(FigureS10a)

doses = doses_DEM
FigureS10b = ggplot() + theme_bw() +
  geom_line(data = filter(modeldata_CDKD_all, StateVar %in% SVs & dose_uM %in% doses),
            aes(x = time, y = value, col = KD), linewidth = 1.5, linetype = "solid") +
  geom_line(data = filter(modeldata_CD, StateVar %in% SVs & dose_uM %in% doses),
              aes(x = time, y = value), col = "black", linewidth = 1, linetype = "solid") +
  facet_grid(cols = vars(dose_uM), rows = vars(StateVar), scales = "free") +
  xlab("Time (hours)") + ylab("GFP intensity") + 
  labs(color = "Knock-Down", title = "DEM")
plot(FigureS10b)

if(SaveFigures == 1){
  ggsave("FigureS10a.svg", plot = FigureS10a, path = "..//Figures", width = 30,
         height = 20, units = "cm", dpi = 300)
  ggsave("FigureS10b.svg", plot = FigureS10b, path = "..//Figures", width = 30,
         height = 20, units = "cm", dpi = 300)
}
```
